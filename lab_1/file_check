#!/bin/bash
#clear
IFS=$'\n'

func () {

for line in `ls -l`
do

rights=`echo $line | awk '{print $1}'`
size=`echo $line | awk '{print $5}'`
date=`echo $line | awk '{print $7 $6 $8}'`

name=`echo $line | awk '{print $9}'`
type=`echo $name | awk -F '.' '{print $2}'`

#if [ "`expr index "$type" mp`" =  0 ]
#then  
#	for duration in `ffmpeg -i $name -hide_banner`
#	do 
#		if [ "`expr index "$duration" Duration`" != "0" ]
#		then x=`expr index "$duration" Duration`
#		duration=${duration: $x : 20}
#		fi
#	done
#fi

name=`echo $name | awk -F '.' '{print $1}'`

if [ `echo $line | awk '{print $3}'` != "" ]
then echo $name,$type,$size,$rights,$date,$duration 
fi

if [ `echo $rights` = "drwxr-xr-x" ]
then 	cd $name/
	echo 1 #trace
	func $1
	echo 2 #trace
	cd -
	echo 3 #trace

fi

done >> $1
}

#______________________________________________________
#if [ -z `dpkg -l | grep ffmpeg` ]
#then sudo apt install ffmpeg
#fi
output=file_result.csv
rm $output

echo name,type,size,rights,date,duration >> $output

func $output

echo "done"

cat file_result.csv


